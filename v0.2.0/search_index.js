var documenterSearchIndex = {"docs":
[{"location":"api/","page":"API","title":"API","text":"","category":"page"},{"location":"api/#SEQ_BRUKER_a_MP2RAGE_CS_360.RawAcquisitionData_MP2RAGE-Tuple{MRIFiles.BrukerFile}","page":"API","title":"SEQ_BRUKER_a_MP2RAGE_CS_360.RawAcquisitionData_MP2RAGE","text":"RawAcquisitionData_MP2RAGE(b::BrukerFile)\n\nConvert a Bruker dataset acquired with the a_MP2RAGE_CS_360 sequence into a  RawAcquisitionData object compatible with the MRIReco functions.\n\nInput :      - b::BrukerFile\n\nOutput :     - raw::RawAcquisitionData\n\n\n\n\n\n","category":"method"},{"location":"api/#SEQ_BRUKER_a_MP2RAGE_CS_360.params_from_seq-Tuple{MRIFiles.BrukerFile}","page":"API","title":"SEQ_BRUKER_a_MP2RAGE_CS_360.params_from_seq","text":"params_from_seq(b::BrukerFile)\n\nExtracts MP2RAGE sequence parameters from a Bruker file and returns them in a ParamsMP2RAGE structure.\n\nArguments\n\nb::BrukerFile: Bruker file containing sequence parameter information.\n\nReturns\n\nA ParamsMP2RAGE structure containing key sequence timings and settings for MP2RAGE reconstruction.\n\n\n\n\n\n","category":"method"},{"location":"api/#SEQ_BRUKER_a_MP2RAGE_CS_360.write_bids_MP2RAGE","page":"API","title":"SEQ_BRUKER_a_MP2RAGE_CS_360.write_bids_MP2RAGE","text":"  write_bids_MP2RAGE(d::Dict,subname::AbstractString,folder=\"\")\n\nThis function writes data from a dictionary (d) in BIDS (Brain Imaging Data Structure) format for MP2RAGE acquisitions.\n\nArguments:\n\nd (Dict): A dictionary containing the data to be written. Expected key-value pairs:\nim_reco (Array): 5D array containing the reconstructed images (x,y,z,NR,TI)\nMP2RAGE (Array): Combined MP2RAGE image data. (x,y,z,NR)\nT1map (Array): Calculated T1 map from MP2RAGE images. (x,y,z,NR)\nparams_prot (Dict): Protocol parameters extracted from the Bruker file.\nparams_MP2RAGE (Struct): Dictionary containing MP2RAGE specific parameters.\nsubname (AbstractString): The name of the subject.\nfolder (AbstractString, optional): The folder where the BIDS data will be written. Defaults to the current directory.\n\nFunctionality:\n\nCreates a directory structure for the anatomical data under folder/subname/anat.\nDefines a list of file paths for different image types associated with MP2RAGE acquisitions.\nExtracts relevant data from the dictionary d for each image type.\nCreates NIfTI volumes (NIVolume) with the extracted data and specified voxel size from d[\"params_prot\"].\nWrites each NIfTI volume to a compressed file (.nii.gz) in the corresponding directory.\nExtracts acquisition parameters from d.\nCreates a dictionary (JSON_dict) containing these parameters in BIDS format:\nInversionTime: List of inversion times (TI1, TI2) in seconds.\nRepetitionTimeExcitation: Repetition time (TR) in seconds.\nRepetitionTimePreparation: MP2RAGE specific repetition time (MP2RAGE_TR) in seconds.\nNumberShots: Echo train length (ETL).\nFlipAngle: List of flip angles (alpha1, alpha2) in degrees.\nMagneticFieldStrength: Magnetic field strength in Tesla.\nUnits: Units for the data (set to \"arbitrary\" in this case).\nWrites the JSON dictionary to a file named MP2RAGE.json in the folder/subname directory.\n\nNote: This function assumes the dictionary d contains the necessary data in the specified format. \n\n\n\n\n\n","category":"function"},{"location":"generated/examples/advanced_reco/#02-CS_reconstruction","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"","category":"section"},{"location":"generated/examples/advanced_reco/#Description","page":"Compressed-sensing reconstruction","title":"Description","text":"","category":"section"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"This example describes how to perform a compressed-sensingreconstruction of a CS-2 accelerated acquisition.","category":"page"},{"location":"generated/examples/advanced_reco/#Loading-Package","page":"Compressed-sensing reconstruction","title":"Loading Package","text":"","category":"section"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"using LazyArtifacts # loading data\nusing SEQ_BRUKER_a_MP2RAGE_CS_360\nusing CairoMakie # plotting","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"In addition we load the package internally used to perform the reconstruction","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"using SEQ_BRUKER_a_MP2RAGE_CS_360.MRIReco\nusing SEQ_BRUKER_a_MP2RAGE_CS_360.MRIReco.RegularizedLeastSquares","category":"page"},{"location":"generated/examples/advanced_reco/#Download-the-datasets","page":"Compressed-sensing reconstruction","title":"Download the datasets","text":"","category":"section"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"if you run the literate example offline change the following line by : `MP2artifacts = artifact\"MP2RAGEdata\"","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"datadir = Main.MP2_artifacts\n@info \"The test data is located at $datadir.\"","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"If you want to perform your own reconstruction, you can change the following line in order to point to another a bruker dataset","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"path_bruker = joinpath(datadir, \"MP2RAGE_CS2\")","category":"page"},{"location":"generated/examples/advanced_reco/#Compressed-sensing-reconstruction","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"","category":"section"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"In order to use an advanced reconstruction we will pass some parameters that will be used by the reconstruction package MRIReco.jl","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"We have to create a parameter dictionnary that will be used. If you need more information about it take a look at MRIReco.jl","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"CS = Dict{Symbol,Any}()\nCS[:sparseTrafo] = \"Wavelet\" #sparse trafo\nCS[:reg] = L1Regularization(100.)       # regularization\nCS[:solver] = FISTA    # solver\nCS[:iterations] = 30\n\nd = reconstruction_MP2RAGE(path_bruker; mean_NR=true,paramsCS = CS)","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"for comparison purposes let's perform the undersampled reconstruction (without the paramCS keyword)","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"d_under = reconstruction_MP2RAGE(path_bruker; mean_NR=true)","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"We can check the results","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"begin\n  f = Figure(size=(500,400))\n  ax=Axis(f[1,1],title=\"TI₁ undersampled\")\n  h=heatmap!(ax,abs.(d_under[\"im_reco\"][:,:,60,1,1]),colormap=:grays)\n\n  ax=Axis(f[1,2],title=\"TI₁ CS\")\n  h=heatmap!(ax,abs.(d[\"im_reco\"][:,:,60,1,1]),colormap=:grays)\n\n\n  ax=Axis(f[2,1],title=\"T₁ map undersampled\")\n  h=heatmap!(ax,d_under[\"T1map\"][:,:,60,1],colorrange = (500,2000))\n\n  ax=Axis(f[2,2],title=\"T₁ map CS\")\n  h=heatmap!(ax,d[\"T1map\"][:,:,60,1],colorrange = (500,2000))\n\n  for ax in f.content   # hide decoration befor adding colorbar\n    hidedecorations!(ax)\n  end\n\n  Colorbar(f[2,3],h,label = \"T₁ [ms]\", flip_vertical_label=true)\n  f\nend","category":"page"},{"location":"generated/examples/advanced_reco/#Write-results-in-BIDS-format","page":"Compressed-sensing reconstruction","title":"Write results in BIDS format","text":"","category":"section"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"Results can be written following most of the qBIDS format recommandation","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"subject_name = \"sub_01_cs\"\ndir_path = \"\" # directory path where the files will be create\nwrite_bids_MP2RAGE(d,subject_name,dir_path)","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"","category":"page"},{"location":"generated/examples/advanced_reco/","page":"Compressed-sensing reconstruction","title":"Compressed-sensing reconstruction","text":"This page was generated using Literate.jl.","category":"page"},{"location":"sequence/#Sequence-and-protocols","page":"Sequence and protocol","title":"Sequence and protocols","text":"","category":"section"},{"location":"sequence/","page":"Sequence and protocol","title":"Sequence and protocol","text":"The sequence, implemented for Bruker Paravision PV-360: 3.5 & 3.6, and the corresponding protocol for fully-sampled  is available in the folder  MR sequence. ","category":"page"},{"location":"sequence/#Enable-compressed-sensing-acquisition","page":"Sequence and protocol","title":"Enable compressed-sensing acquisition","text":"","category":"section"},{"location":"sequence/","page":"Sequence and protocol","title":"Sequence and protocol","text":"Compressed-sensing implementation is available through the standard Bruker tab Resolution/Encoding. If you want to perform a compressed-sensing experiment with an acceleration of 2 like the one used here : acceleration factor = 50% and use a calibration size of 5%","category":"page"},{"location":"sequence/","page":"Sequence and protocol","title":"Sequence and protocol","text":"##$PVM_EncCSUndersampling=50\n##$PVM_EncCSCenterRatio=5","category":"page"},{"location":"sequence/#Source-code","page":"Sequence and protocol","title":"Source code","text":"","category":"section"},{"location":"sequence/","page":"Sequence and protocol","title":"Sequence and protocol","text":"Source code is available in this private directory : https://github.com/aTrotier/a_MP2RAGE_CS_360","category":"page"},{"location":"reconstruction/#Installation-and-usage","page":"Installation and usage","title":"Installation and usage","text":"","category":"section"},{"location":"reconstruction/#Package-Installation","page":"Installation and usage","title":"Package Installation","text":"","category":"section"},{"location":"reconstruction/","page":"Installation and usage","title":"Installation and usage","text":"You can install the package in any project with the following command :","category":"page"},{"location":"reconstruction/","page":"Installation and usage","title":"Installation and usage","text":"launch julia with the command julia\nenter the Julia package manager by typing ] in the REPL. (the REPL should turn in blue)\nif you want to activate an environment, type : activate . (otherwise the package will be installed in the global environment)\nIn order to add our unregistered package, type add https://github.com/CRMSB/SEQ_BRUKER_a_MP2RAGE_CS_360\nif you want to use the package in your script just add the following line : using SEQ_BRUKER_a_MP2RAGE_CS_360","category":"page"},{"location":"reconstruction/#How-to-use-the-package","page":"Installation and usage","title":"How to use the package","text":"","category":"section"},{"location":"reconstruction/","page":"Installation and usage","title":"Installation and usage","text":"Follow the example in the documentation ","category":"page"},{"location":"reconstruction/","page":"Installation and usage","title":"Installation and usage","text":"Steps :","category":"page"},{"location":"reconstruction/","page":"Installation and usage","title":"Installation and usage","text":"Define the path to the bruker dataset","category":"page"},{"location":"reconstruction/","page":"Installation and usage","title":"Installation and usage","text":"path_bruker = joinpath(datadir, \"MP2RAGE_FULLY\")","category":"page"},{"location":"reconstruction/","page":"Installation and usage","title":"Installation and usage","text":"Perform the reconstruction ","category":"page"},{"location":"reconstruction/","page":"Installation and usage","title":"Installation and usage","text":"d = reconstruction_MP2RAGE(path_bruker; mean_NR=true)","category":"page"},{"location":"reconstruction/","page":"Installation and usage","title":"Installation and usage","text":"write the results in the qBIDS format","category":"page"},{"location":"reconstruction/","page":"Installation and usage","title":"Installation and usage","text":"subject_name = \"sub_01\"\ndir_path = \"\" # directory path where the files will be create\nwrite_bids_MP2RAGE(d,subject_name,dir_path)","category":"page"},{"location":"#SEQ_BRUKER_A_MP2RAGE_CS_360","page":"Home","title":"SEQ_BRUKER_A_MP2RAGE_CS_360","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"SEQ_BRUKER_a_MP2RAGE_CS_360.jl is a Julia package that implements a reconstruction for an accelerated MP2RAGE sequence for Bruker scanner (PV360-3.5 and PV360-3.6).  The reconstruction is performed using MRIReco.jl ","category":"page"},{"location":"","page":"Home","title":"Home","text":"More information and examples are available in the initial article","category":"page"},{"location":"#Raw-datasets","page":"Home","title":"Raw datasets","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The rawdata used in the example are stored on zenodo : https://zenodo.org/records/14046657","category":"page"},{"location":"","page":"Home","title":"Home","text":"One is a fully sampled acquisition (128x128x96)\nThe other one is accelerated by a factor of 2","category":"page"},{"location":"","page":"Home","title":"Home","text":"##$PVM_EncCSUndersampling=50\n##$PVM_EncCSCenterRatio=5","category":"page"},{"location":"","page":"Home","title":"Home","text":"They are used for each merge to generate the figures used in examples.","category":"page"},{"location":"#How-to-give-credit","page":"Home","title":"How to give credit","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"If you use this package please acknowledge us by citing : https://doi.org/10.1002/mrm.27438","category":"page"},{"location":"","page":"Home","title":"Home","text":"Additionally, if you use the sequence available in the MR sequence folder, please contact us to sign the sequence transfer agreement : aurelien.trotier@rmsb.u-bordeaux.fr","category":"page"},{"location":"generated/examples/example_slab_correction/#03-slab-correction","page":"Slab correction","title":"Slab correction","text":"","category":"section"},{"location":"generated/examples/example_slab_correction/#Description","page":"Slab correction","title":"Description","text":"","category":"section"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"This example describes how to correct the slab profile excitation produced by a non-ideal excitation RF pulse.","category":"page"},{"location":"generated/examples/example_slab_correction/#Loading-Package","page":"Slab correction","title":"Loading Package","text":"","category":"section"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"using LazyArtifacts # loading data\nusing SEQ_BRUKER_a_MP2RAGE_CS_360\nusing CairoMakie # plotting","category":"page"},{"location":"generated/examples/example_slab_correction/#Download-the-datasets","page":"Slab correction","title":"Download the datasets","text":"","category":"section"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"If you run the literate example offline, run the following line: MP2_artifacts = artifact\"MP2RAGE_data\"","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"datadir = Main.MP2_artifacts\n\n@info \"The test data is located at $datadir.\"","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"If you want to perform your own reconstruction, you can change the following line to point to another Bruker dataset.","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"path_sinc = joinpath(datadir, \"sinc10H\")\npath_hermite = joinpath(datadir, \"hermite\")","category":"page"},{"location":"generated/examples/example_slab_correction/#Perform-the-standard-reconstruction","page":"Slab correction","title":"Perform the standard reconstruction","text":"","category":"section"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"First, let's reconstruct two acquisitions performed on the same animal: one with a sinc10H excitation pulse and the second with a hermite pulse.","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"d_hermite = reconstruction_MP2RAGE(path_hermite; mean_NR=true)\nd_sinc = reconstruction_MP2RAGE(path_sinc; mean_NR=true)\n\nbegin\n  sl = 48\n  f = Figure(size=(600,200))\n  ax=Axis(f[1,1],title=\"sinc10H\")\n  h=heatmap!(ax,d_sinc[\"MP2RAGE\"][:,sl,:,1],colormap=:grays)\n  arrows2d!(ax,(48,85),(20,0),color=:red)\n\n  ax=Axis(f[1,2],title=\"hermite\")\n  h=heatmap!(ax,d_hermite[\"MP2RAGE\"][:,sl,:,1],colormap=:grays)\n  arrows2d!(ax,(48,85),(20,0),color=:red)\n\n  ax=Axis(f[1,3],title=\"diff\")\n  h=heatmap!(ax,(d_sinc[\"MP2RAGE\"] .- d_hermite[\"MP2RAGE\"])[:,sl,:,1],colormap=:grays,colorrange = (-0.1,0.1))\n  arrows2d!(ax,(48,85),(20,0),color=:red)\n  arrows2d!(ax,(48,15),(20,0),color=:green)\n\n  for ax in f.content   # hide decoration befor adding colorbar\n    hidedecorations!(ax)\n  end\n  Colorbar(f[1,4],h,)\n  f\nend","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"You can observe signal inhomogeneity along the top-to-bottom axis. This is especially visible in the difference between the two images. The pattern is visible at the top (red arrow) and at the bottom (green arrow).","category":"page"},{"location":"generated/examples/example_slab_correction/#Artefact-explanation-:-slab-excitation-profile","page":"Slab correction","title":"Artefact explanation : slab excitation profile","text":"","category":"section"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"This artifact can be explained by the slab excitation profile of the RF pulse. In the next figure, we show the effective angle of excitation along the slice orientation (corresponding to the Y axis in the previous figure).","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"using SEQ_BRUKER_a_MP2RAGE_CS_360.MRIFiles\nprofile_sinc = extract_slab_profile(BrukerFile(path_sinc))\nprofile_hermite= extract_slab_profile(BrukerFile(path_hermite))\n\nbegin\n  f = Figure(size=(500,400))\n  ax=Axis(f[1,1],title=\"sinc10H\",xlabel=\"partition position\", ylabel=\"Effective angle (degrees)\")\n  ax.xticks=[1,8,25,50,75,89,96]\n  lines!(ax,profile_sinc)\n  vlines!(ax,8,color=:green,linestyle=:dash)\n  vlines!(ax,96-8+1,color=:green,linestyle=:dash)\n\n  hlines!(ax,7,color=:red,linestyle=:dash)\n  ax=Axis(f[2,1],title=\"hermite\",xlabel=\"partition position\", ylabel=\"Effective angle (degrees)\")\n  ax.xticks=[1,25,50,75,96]\n  lines!(ax,profile_hermite)\n  hlines!(ax,7,color=:red,linestyle=:dash)\n\n  f\nend","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"As you can see, the sinc10H reaches the expected angle of 7 degrees after 8 partitions/voxels, but in the hermite case, we observe a large oscillation. This effect creates the differences in the MP2RAGE image.","category":"page"},{"location":"generated/examples/example_slab_correction/#Correction-of-the-slab-profile","page":"Slab correction","title":"Correction of the slab profile","text":"","category":"section"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"Knowing the shape of the RF pulse, we are able to correct this effect when computing the T1 maps from the MP2RAGE images. To do so, for each position along the partition, we generate a different lookup table with the correct effective angle and compute the T1 map for this partition. To enable slab correction, you can pass the keyword slab_correction=true.","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"d_hermite_corr = reconstruction_MP2RAGE(path_hermite; mean_NR=true, slab_correction = true)\nd_sinc_corr = reconstruction_MP2RAGE(path_sinc; mean_NR=true, slab_correction = true)\n\nbegin\n  T1range = (1000,2000)\n  using QMRIColors\n  cmap,imClip_sinc = relaxationColorMap(\"T1\",d_sinc[\"T1map\"][:,sl,:,1],T1range[1],T1range[2])\n  cmap,imClip_hermite = relaxationColorMap(\"T1\",d_hermite[\"T1map\"][:,sl,:,1],T1range[1],T1range[2])\n  cmap,imClip_sinc_corr = relaxationColorMap(\"T1\",d_sinc_corr[\"T1map\"][:,sl,:,1],T1range[1],T1range[2])\n  cmap,imClip_hermite_corr = relaxationColorMap(\"T1\",d_hermite_corr[\"T1map\"][:,sl,:,1],T1range[1],T1range[2])\n\n  f = Figure(size=(600,400))\n\n  ax=Axis(f[1,1],title=\"sinc10H\")\n  h=heatmap!(ax,imClip_sinc,colorrange = T1range, colormap=cmap)\n\n  ax=Axis(f[1,2],title=\"hermite\")\n  h=heatmap!(ax,imClip_hermite,colorrange = T1range, colormap=cmap)\n  arrows2d!(ax,(48,85),(20,0),color=:red)\n\n  ax=Axis(f[2,1],title=\"sinc10H\")\n  h=heatmap!(ax,imClip_sinc_corr,colorrange = T1range, colormap=cmap)\n\n  ax=Axis(f[2,2],title=\"hermite\")\n  hT1=heatmap!(ax,imClip_hermite_corr,colorrange = T1range, colormap=cmap)\n\n  ax=Axis(f[1,4],title=\"diff\")\n  h=heatmap!(ax,d_sinc[\"T1map\"][:,sl,:,1]-d_hermite[\"T1map\"][:,sl,:,1],colormap=:grays,colorrange=(-100,100))\n\n  ax=Axis(f[2,4],title=\"diff corrected\")\n  h=heatmap!(ax,d_sinc_corr[\"T1map\"][:,sl,:,1]-d_hermite_corr[\"T1map\"][:,sl,:,1],colormap=:grays,colorrange=(-100,100))\n\n  for ax in f.content   # hide decoration befor adding colorbar\n    hidedecorations!(ax)\n  end\n  Colorbar(f[:,3],hT1,label = \"T₁ [ms]\", flip_vertical_label=true)\n  Colorbar(f[:,5],h,label = \"ΔT₁ [ms]\", flip_vertical_label=true)\n\n  Label(f[1,-1], \"Initial\", rotation = pi/2)\n  Label(f[2,-1], \"Corrected\", rotation = pi/2)\n\n  rowsize!(f.layout,1,100)\n  rowsize!(f.layout,2,100)\n  colgap!(f.layout,1,0)\n  colsize!(f.layout,0,0)\n  f\nend","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"The MP2RAGE images are also corrected during this process. They are computed from the corrected T1 map using the expected flip angles.","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"begin\n  T1range = (-0.5,0.5)\n  f = Figure(size=(600,400))\n\n  ax=Axis(f[1,1],title=\"sinc10H\")\n  h=heatmap!(ax,d_sinc[\"MP2RAGE\"][:,sl,:,1],colormap=:grays,colorrange = T1range)\n\n  ax=Axis(f[1,2],title=\"hermite\")\n  h=heatmap!(ax,d_hermite[\"MP2RAGE\"][:,sl,:,1],colormap=:grays,colorrange = T1range)\n  arrows2d!(ax,(48,85),(20,0),color=:red)\n\n  ax=Axis(f[2,1],title=\"sinc10H\")\n  h=heatmap!(ax,d_sinc_corr[\"MP2RAGE\"][:,sl,:,1],colormap=:grays,colorrange = T1range)\n\n  ax=Axis(f[2,2],title=\"hermite\")\n  hT1=heatmap!(ax,d_hermite_corr[\"MP2RAGE\"][:,sl,:,1],colormap=:grays,colorrange = T1range)\n\n  ax=Axis(f[1,4],title=\"diff\")\n  h=heatmap!(ax,d_sinc[\"MP2RAGE\"][:,sl,:,1]-d_hermite[\"MP2RAGE\"][:,sl,:,1],colormap=:grays,colorrange=(-0.1,0.1))\n\n  ax=Axis(f[2,4],title=\"diff corrected\")\n  h=heatmap!(ax,d_sinc_corr[\"MP2RAGE\"][:,sl,:,1]-d_hermite_corr[\"MP2RAGE\"][:,sl,:,1],colormap=:grays,colorrange=(-0.1,0.1))\n\n  for ax in f.content   # hide decoration befor adding colorbar\n    hidedecorations!(ax)\n  end\n  Colorbar(f[1:2,3],hT1,label = \"MP2RAGE [ms]\", flip_vertical_label=true)\n  Colorbar(f[1:2,5],h,label = \"Δ MP2RAGE [ms]\", flip_vertical_label=true)\n\n  Label(f[1,-1], \"Initial\", rotation = pi/2)\n  Label(f[2,-1], \"Corrected\", rotation = pi/2)\n\n  rowsize!(f.layout,1,100)\n  rowsize!(f.layout,2,100)\n  colgap!(f.layout,1,0)\n  colsize!(f.layout,0,0)\n  f\nend","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"Unfortunately, the correction can't be applied to TI1 and TI2 because proton density ρ, T₂*, and B₁- effects are not known.","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"","category":"page"},{"location":"generated/examples/example_slab_correction/","page":"Slab correction","title":"Slab correction","text":"This page was generated using Literate.jl.","category":"page"},{"location":"generated/examples/simple_reco/#01-simple_reconstruction","page":"Simple reconstruction","title":"Simple reconstruction","text":"","category":"section"},{"location":"generated/examples/simple_reco/#Description","page":"Simple reconstruction","title":"Description","text":"","category":"section"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"This example describes how to perform a reconstruction of a fully acquisition acquired with the aMP2RAGECS_360 sequence.","category":"page"},{"location":"generated/examples/simple_reco/#Loading-Package","page":"Simple reconstruction","title":"Loading Package","text":"","category":"section"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"using LazyArtifacts # loading data\nusing SEQ_BRUKER_a_MP2RAGE_CS_360\nusing CairoMakie # plotting","category":"page"},{"location":"generated/examples/simple_reco/#Download-the-datasets","page":"Simple reconstruction","title":"Download the datasets","text":"","category":"section"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"if you run the literate example offline change the following line by : `MP2artifacts = artifact\"MP2RAGEdata\"","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"datadir = Main.MP2_artifacts\n@info \"The test data is located at $datadir.\"","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"If you want to perform your own reconstruction, you can change the following line in order to point to another a bruker dataset","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"path_bruker = joinpath(datadir, \"MP2RAGE_FULLY\")","category":"page"},{"location":"generated/examples/simple_reco/#Perform-the-reconstruction","page":"Simple reconstruction","title":"Perform the reconstruction","text":"","category":"section"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"this function will perform a standard reconstruction without compressed-sensing. If your data are subsampled it will result in subsampling artifacts (blurring + noise-like)","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"the keyword mean_NR=true will average the images accross the number of repetition dimension before performing the MP2RAGE/T1 maps estimation. Otherwise an image/T₁ map will be generated for each Number Of Repetition (NR)","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"d = reconstruction_MP2RAGE(path_bruker; mean_NR=true)","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"the result is a dictionnary with the following fields :","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"\"im_reco\" : (x,y,z, Number of Repetition,TI) Complex\n\"MP2RAGE\" : (x,y,z , Number of Repetition) Float\n\"T1map\" : (x,y,z , Number of Repetition) Float\n\"params_prot\"\n\"params_reco\"\n\"params_MP2RAGE\"","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"im_reco corresponds to the TI₁ and TI₂ images in the complex format with 5 dimensions : (x,y,z , Number of Repetition,TI). Channels are combined during the reconstruction","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"We can check the results","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"begin\n  f = Figure(size=(500,400))\n  ax=Axis(f[1,1],title=\"TI₁\")\n  h=heatmap!(ax,abs.(d[\"im_reco\"][:,:,60,1,1]),colormap=:grays)\n\n  ax=Axis(f[1,2],title=\"TI₂\")\n  h=heatmap!(ax,abs.(d[\"im_reco\"][:,:,60,1,2]),colormap=:grays)\n\n  ax=Axis(f[2,1],title=\"UNIT1 / MP2RAGE\")\n  h=heatmap!(ax,d[\"MP2RAGE\"][:,:,60,1],colormap=:grays)\n\n  ax=Axis(f[2,2],title=\"T₁ map\")\n  h=heatmap!(ax,d[\"T1map\"][:,:,60,1],colorrange = (500,2000))\n\n  for ax in f.content   # hide decoration befor adding colorbar\n    hidedecorations!(ax)\n  end\n\n  Colorbar(f[2,3],h,label = \"T₁ [ms]\", flip_vertical_label=true)\n  f\nend","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"The Lookup table used for the reconstruction is stored in the dictionnary (LUT). First dimension is the range of T1 and the 2nd is the expected value of the MP2RAGE signal between -0.5 to 0.5.","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"f=Figure()\nax = Axis(f[1,1],xlabel=\"T₁ [ms]\")\nlines!(ax,d[\"LUT\"])\nf","category":"page"},{"location":"generated/examples/simple_reco/#Write-results-in-BIDS-format","page":"Simple reconstruction","title":"Write results in BIDS format","text":"","category":"section"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"Results can be written following most of the qBIDS format recommandation","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"subject_name = \"sub_01\"\ndir_path = \"\" # directory path where the files will be create\nwrite_bids_MP2RAGE(d,subject_name,dir_path)","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"which results in :","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"sub_01/\n├─ MP2RAGE.json\n└─ anat/\n   ├─ sub_01_T1map.nii.gz\n   ├─ sub_01_UNIT1.nii.gz\n   ├─ sub_01_inv-1-complex_MP2RAGE.nii.gz\n   ├─ sub_01_inv-1-mag_MP2RAGE.nii.gz\n   ├─ sub_01_inv-1-phase_MP2RAGE.nii.gz\n   ├─ sub_01_inv-2-complex_MP2RAGE.nii.gz\n   ├─ sub_01_inv-2-mag_MP2RAGE.nii.gz\n   └─ sub_01_inv-2-phase_MP2RAGE.nii.gz","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"For simplicity the T₁ map is stored in the anat/ folder like the ones created by Siemens.","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"If you want to generate the T1 map with another tool like qMRLab the required MP2RAGE parameters are stored in the MP2RAGE.json file. In that case the data are supposed to be stored in a derivatives folder (seeqBIDS format recommandation)","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"","category":"page"},{"location":"generated/examples/simple_reco/","page":"Simple reconstruction","title":"Simple reconstruction","text":"This page was generated using Literate.jl.","category":"page"}]
}
