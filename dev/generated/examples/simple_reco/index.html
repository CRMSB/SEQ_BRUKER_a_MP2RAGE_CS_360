<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Simple reconstruction · SEQ_BRUKER_a_MP2RAGE_CS_360.jl</title><meta name="title" content="Simple reconstruction · SEQ_BRUKER_a_MP2RAGE_CS_360.jl"/><meta property="og:title" content="Simple reconstruction · SEQ_BRUKER_a_MP2RAGE_CS_360.jl"/><meta property="twitter:title" content="Simple reconstruction · SEQ_BRUKER_a_MP2RAGE_CS_360.jl"/><meta name="description" content="Documentation for SEQ_BRUKER_a_MP2RAGE_CS_360.jl."/><meta property="og:description" content="Documentation for SEQ_BRUKER_a_MP2RAGE_CS_360.jl."/><meta property="twitter:description" content="Documentation for SEQ_BRUKER_a_MP2RAGE_CS_360.jl."/><meta property="og:url" content="https://CRMSB.github.io/SEQ_BRUKER_a_MP2RAGE_CS_360.jl/generated/examples/simple_reco/"/><meta property="twitter:url" content="https://CRMSB.github.io/SEQ_BRUKER_a_MP2RAGE_CS_360.jl/generated/examples/simple_reco/"/><link rel="canonical" href="https://CRMSB.github.io/SEQ_BRUKER_a_MP2RAGE_CS_360.jl/generated/examples/simple_reco/"/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">SEQ_BRUKER_a_MP2RAGE_CS_360.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><a class="tocitem" href="../../../sequence/">Sequence and protocol</a></li><li><a class="tocitem" href="../../../reconstruction/">Installation and usage</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Simple reconstruction</a><ul class="internal"><li><a class="tocitem" href="#Description"><span>Description</span></a></li><li><a class="tocitem" href="#Loading-Package"><span>Loading Package</span></a></li><li><a class="tocitem" href="#Download-the-datasets"><span>Download the datasets</span></a></li><li><a class="tocitem" href="#Perform-the-reconstruction"><span>Perform the reconstruction</span></a></li><li><a class="tocitem" href="#Write-results-in-BIDS-format"><span>Write results in BIDS format</span></a></li></ul></li><li><a class="tocitem" href="../advanced_reco/">Compressed-sensing reconstruction</a></li></ul></li><li><a class="tocitem" href="../../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Simple reconstruction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Simple reconstruction</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CRMSB/SEQ_BRUKER_a_MP2RAGE_CS_360" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CRMSB/SEQ_BRUKER_a_MP2RAGE_CS_360/blob/main/docs/lit/examples/simple_reco.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="01-simple_reconstruction"><a class="docs-heading-anchor" href="#01-simple_reconstruction">Simple reconstruction</a><a id="01-simple_reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#01-simple_reconstruction" title="Permalink"></a></h1><h2 id="Description"><a class="docs-heading-anchor" href="#Description">Description</a><a id="Description-1"></a><a class="docs-heading-anchor-permalink" href="#Description" title="Permalink"></a></h2><p>This example describes how to perform a reconstruction of a fully acquisition acquired with the a<em>MP2RAGE</em>CS_360 sequence.</p><h2 id="Loading-Package"><a class="docs-heading-anchor" href="#Loading-Package">Loading Package</a><a id="Loading-Package-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-Package" title="Permalink"></a></h2><pre><code class="language-julia hljs">using LazyArtifacts # loading data
using SEQ_BRUKER_a_MP2RAGE_CS_360
using CairoMakie # plotting</code></pre><h2 id="Download-the-datasets"><a class="docs-heading-anchor" href="#Download-the-datasets">Download the datasets</a><a id="Download-the-datasets-1"></a><a class="docs-heading-anchor-permalink" href="#Download-the-datasets" title="Permalink"></a></h2><p>if you run the literate example offline change the following line by : `MP2<em>artifacts = artifact&quot;MP2RAGE</em>data&quot;</p><pre><code class="language-julia hljs">datadir = Main.MP2_artifacts
@info &quot;The test data is located at $datadir.&quot;</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr36"><span class="sgr1">[ Info: </span></span>The test data is located at /home/runner/.julia/artifacts/04cd4c29bb9e2aeb5384fbc70a9af0e1a37ca369.</code></pre><p>If you want to perform your own reconstruction, you can change the following line in order to point to another a bruker dataset</p><pre><code class="language-julia hljs">path_bruker = joinpath(datadir, &quot;MP2RAGE_FULLY&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;/home/runner/.julia/artifacts/04cd4c29bb9e2aeb5384fbc70a9af0e1a37ca369/MP2RAGE_FULLY&quot;</code></pre><h2 id="Perform-the-reconstruction"><a class="docs-heading-anchor" href="#Perform-the-reconstruction">Perform the reconstruction</a><a id="Perform-the-reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#Perform-the-reconstruction" title="Permalink"></a></h2><p>this function will perform a standard reconstruction without compressed-sensing. If your data are subsampled it will result in subsampling artifacts (blurring + noise-like)</p><p>the keyword mean_NR=true will average the images accross the number of repetition dimension before performing the MP2RAGE/T1 maps estimation. Otherwise an image/T₁ map will be generated for each Number Of Repetition (NR)</p><pre><code class="language-julia hljs">d = reconstruction_MP2RAGE(path_bruker; mean_NR=true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Any, Any} with 7 entries:
  &quot;LUT&quot;            =&gt; Float32[93.0 0.5; 94.0 0.5; … ; 5287.0 -0.5; 5288.0 -0.5]
  &quot;params_reco&quot;    =&gt; Dict{Any, Any}(:iterations=&gt;1, :reconSize=&gt;(128, 128, 96)…
  &quot;params_MP2RAGE&quot; =&gt; ParamsMP2RAGE(800.0, 2284.1, 7.0, 5000.0, 128, 7.0, 7.0)
  &quot;im_reco&quot;        =&gt; ComplexF32[113.687-120.06im -6.39106+141.334im … 35.198+4…
  &quot;T1map&quot;          =&gt; Float32[4376.0 3452.0 … 2116.0 2853.0; 3571.0 377.0 … 238…
  &quot;params_prot&quot;    =&gt; BrukerFile: /home/runner/.julia/artifacts/04cd4c29bb9e2ae…
  &quot;MP2RAGE&quot;        =&gt; Float32[-0.493312 -0.458414 … -0.244732 -0.399954; -0.465…</code></pre><p>the result is a dictionnary with the following fields :</p><ul><li>&quot;im_reco&quot; : (x,y,z, Number of Repetition,TI) Complex</li><li>&quot;MP2RAGE&quot; : (x,y,z , Number of Repetition) Float</li><li>&quot;T1map&quot; : (x,y,z , Number of Repetition) Float</li><li>&quot;params_prot&quot;</li><li>&quot;params_reco&quot;</li><li>&quot;params_MP2RAGE&quot;</li></ul><p>im_reco corresponds to the TI₁ and TI₂ images in the complex format with 5 dimensions : (x,y,z , Number of Repetition,TI). Channels are combined during the reconstruction</p><p>We can check the results</p><pre><code class="language-julia hljs">begin
  f = Figure(size=(500,400))
  ax=Axis(f[1,1],title=&quot;TI₁&quot;)
  h=heatmap!(ax,abs.(d[&quot;im_reco&quot;][:,:,60,1,1]),colormap=:grays)

  ax=Axis(f[1,2],title=&quot;TI₂&quot;)
  h=heatmap!(ax,abs.(d[&quot;im_reco&quot;][:,:,60,1,2]),colormap=:grays)

  ax=Axis(f[2,1],title=&quot;UNIT1 / MP2RAGE&quot;)
  h=heatmap!(ax,d[&quot;MP2RAGE&quot;][:,:,60,1],colormap=:grays)

  ax=Axis(f[2,2],title=&quot;T₁ map&quot;)
  h=heatmap!(ax,d[&quot;T1map&quot;][:,:,60,1],colorrange = (500,2000))

  for ax in f.content   # hide decoration befor adding colorbar
    hidedecorations!(ax)
  end

  Colorbar(f[2,3],h,label = &quot;T₁ [ms]&quot;, flip_vertical_label=true)
  f
end</code></pre><img src="b97e1550.png" alt="Example block output"/><p>The Lookup table used for the reconstruction is stored in the dictionnary (LUT). First dimension is the range of T1 and the 2nd is the expected value of the MP2RAGE signal between -0.5 to 0.5.</p><pre><code class="language-julia hljs">f=Figure()
ax = Axis(f[1,1],xlabel=&quot;T₁ [ms]&quot;)
lines!(ax,d[&quot;LUT&quot;])
f</code></pre><img src="c60a08a4.png" alt="Example block output"/><h2 id="Write-results-in-BIDS-format"><a class="docs-heading-anchor" href="#Write-results-in-BIDS-format">Write results in BIDS format</a><a id="Write-results-in-BIDS-format-1"></a><a class="docs-heading-anchor-permalink" href="#Write-results-in-BIDS-format" title="Permalink"></a></h2><p>Results can be written following most of the <a href="https://bids-specification.readthedocs.io/en/stable/appendices/qmri.html">qBIDS format recommandation</a></p><pre><code class="language-julia hljs">subject_name = &quot;sub_01&quot;
dir_path = &quot;&quot; # directory path where the files will be create
write_bids_MP2RAGE(d,subject_name,dir_path)</code></pre><p>which results in :</p><pre><code class="nohighlight hljs">sub_01/
├─ MP2RAGE.json
└─ anat/
   ├─ sub_01_T1map.nii.gz
   ├─ sub_01_UNIT1.nii.gz
   ├─ sub_01_inv-1-complex_MP2RAGE.nii.gz
   ├─ sub_01_inv-1-mag_MP2RAGE.nii.gz
   ├─ sub_01_inv-1-phase_MP2RAGE.nii.gz
   ├─ sub_01_inv-2-complex_MP2RAGE.nii.gz
   ├─ sub_01_inv-2-mag_MP2RAGE.nii.gz
   └─ sub_01_inv-2-phase_MP2RAGE.nii.gz</code></pre><p>For simplicity the T₁ map is stored in the anat/ folder like the ones created by Siemens.</p><p>If you want to generate the T1 map with another tool like qMRLab the required MP2RAGE parameters are stored in the <strong>MP2RAGE.json</strong> file. In that case the data are supposed to be stored in a derivatives folder (see<a href="https://bids-specification.readthedocs.io/en/stable/appendices/qmri.html">qBIDS format recommandation</a>)</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../reconstruction/">« Installation and usage</a><a class="docs-footer-nextpage" href="../advanced_reco/">Compressed-sensing reconstruction »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 22 July 2025 15:24">Tuesday 22 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
